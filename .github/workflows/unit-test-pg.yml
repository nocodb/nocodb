name: "Unit Test PG"

on:
  workflow_call:
    inputs:
      test_set:
        description: 'Test set number'
        required: true
        type: string

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  unit-tests-pg:
    runs-on: [self-hosted, v4, generic]
    timeout-minutes: 40
    steps:
      - name: run sql-executor
        working-directory: ./packages/nc-sql-executor
        run: |
          pnpm run dev &
      - name: run unit tests
        working-directory: ./packages/nocodb
        run: pnpm run test:unit:pg:ee --forbid-only --test-set-${{ inputs.test_set }}